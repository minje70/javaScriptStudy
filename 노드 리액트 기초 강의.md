# boilerplate

## Boilerplate ë€ [ì¡´ ì•ˆ](https://www.inflearn.com/course/%EB%94%B0%EB%9D%BC%ED%95%98%EB%A9%B0-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%85%B8%EB%93%9C-%EB%A6%AC%EC%95%A1%ED%8A%B8-%EA%B8%B0%EB%B3%B8/lecture/37061)

ë³€ê²½ ì—†ì´ ê³„ì†í•˜ì—¬ ì¬ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì½”ë“œë¥¼ ë§í•œë‹¤.

ì´ í›„ ì¤‘ë³µë˜ëŠ” ì„¤ëª…ì„ ìµœëŒ€í•œ ì—†ì• ê¸° ìœ„í•´ì„œ ë§Œë“  ê°•ì¢Œë¼ê³  í•¨.

### NODE JSë€?? EXPRESS JS ë€?

- Node jsëŠ” í•˜ë‚˜ì˜ ì–¸ì–´ë¡œ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì„œë²„ì‚¬ì´ë“œì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì–¸ì–´ì´ë‹¤.
- express jsëŠ” í”„ë ˆì„ì›Œí¬ë¡œ node jsë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ë¥¼ ë§Œë“¤ ìˆ˜ ìˆëŠ” ë„êµ¬ì´ë‹¤.



### node js ë°›ê¸°.

##### node jsê°€ ìˆëŠ”ì§€ í™•ì¸

- í„°ë¯¸ë„ì—ì„œ `node -v` ì…ë ¥



##### [node ë‹¤ìš´ë¡œë“œ](https://nodejs.org/ko/)



##### npm init

- ì‹¤í–‰í•˜ë©´ ê¸°ë³¸ ì„¸íŒ…íŒŒì¼ì¸ package.jsonì„ ë§Œë“¤ì–´ ì¤€ë‹¤.

##### index.js

- ë°±ì—”ë“œì˜ ì‹œì‘ì ì´ë‹¤.

##### express ë‹¤ìš´ë¡œë“œ

- í„°ë¯¸ë„ì—ì„œ `npm install express --save` ì…ë ¥
- ë°›ìœ¼ë©´ package.jsonì— `"express": "^4.17.1"`ì´ ì¶”ê°€ëœë‹¤.
- Node_modulesë¼ëŠ” í´ë”ë„ ì¶”ê°€ ëœë‹¤.

##### mongoldb

- Mongoldb.com íšŒì›ê°€ì….
- create new cluster
  - aws, singapore, m0(free)ì„ íƒ
- clusterê°€ ìƒì„±ë˜ë©´ connectì— ë“¤ì–´ê°€ì„œ usernameê³¼ passwordë¥¼ ì…ë ¥ í›„ ë‹¤ í™•ì¸
- application codeê°€ ë‚˜ì˜¤ë©´ ë³µë¶™í•´ì„œ ì €ì¥í•´ë‘ê¸°.

##### mongoose

- mongodbë¥¼ í¸í•˜ê²Œ ì“¸ ìˆ˜ ìˆëŠ” Object Modeling Toolì´ë‹¤.
- í„°ë¯¸ë„ì— `npm install mongoose --save`ë¥¼ ì…ë ¥í•˜ë©´ ì¶”ê°€ëœë‹¤.
- Index.jsì— ì½”ë“œë¥¼ ì¶”ê°€í•œë‹¤.

``` javascript
const mongoose = require('mongoose')
mongoose.connect('mongodb+srv://mijeong:ch79854622@boilerplate.w1dqh.mongodb.net/myFirstDatabase?retryWrites=true&w=majority', {
	useNewUrlParser: true, useUnifiedTopology: true, useCreateIndex: true, useFindAndModify: false
}).then(() => console.log('MongoDB Connected...'))
	.catch(err => console.log(err))
```

- í„°ë¯¸ë„ì— `npm run start`ë¥¼ ì…ë ¥í•œë‹¤.

###### ğŸ˜‚ì£¼ì˜ì‚¬í•­

- passwordì…ë ¥í•˜ëŠ” ë¶€ë¶„ì— <>ëŠ” ì—†ì• ê¸°
- cluster ì»´í“¨í„°ì—ì„œëŠ” ë°©í™”ë²½ ë•Œë¬¸ì— mongodbì—ì„œ ë§¥ìœ¼ë¡œ ì ‘ê·¼ì„ ëª»í•˜ëŠ”ê±° ê°™ë‹¤.
- network accessì—ì„œ í˜„ì¬ ipaddressë¥¼ ë“±ë¡í•´ì¤˜ì•¼í•œë‹¤.

### Model & Schema

- model : schemaë¥¼ ê°ì‹¸ì£¼ëŠ” ê²ƒ.
- schema : ì°¾ì•„ë³´ê¸°. (ì„¤ëª…ì´ ë„ˆë¬´ ë¶€ì‹¤.)

``` javascript
const mongoose = require('mongoose'); // ëª¨ë“ˆì„ ê°€ì ¸ì˜¤ëŠ” ë¶€ë¶„.

const userSchema = mongoose.Schema({
	name: {
		type: String,
		maxlength: 50,
	},
	email: {
		type: String,
		trim: true, // emailì— ìˆëŠ” ê³µë°±ì„ ì—†ì• ì¤€ë‹¤.
		unique: 1 // ë“±ë¡ì„ í•˜ë‚˜ë§Œ í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.
	},
	password: {
		type: String,
		minlength: 5,
	},
	lastname: {
		type: String,
		maxlength: 50,
	},
	role: {
		type: Number,
		default: 0, // ìœ ì €ê°€ ë  ìˆ˜ ìˆê³  ê´€ë¦¬ìê°€ ë  ìˆ˜ ìˆë‹¤. ê·¸ëŸ° gradeë¥¼ ì •í•˜ëŠ” ë“¯ ì‹¶ë‹¤.
	},
	image: String,
	token: {
		type: String, // ìœ íš¨ì„± ê´€ë¦¬ë¥¼ ìœ„í•¨.
	},
	tokenExp: { // í† í°ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ê°„.
		type: Number,
	},
})

const User = mongoose.model('User', userSchema) // userschemaë¥¼ modelë¡œ ê°ì‹¸ì¤€ë‹¤.

module.exports = { User } // ë‹¤ë¥¸ ê³³ì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ exportsí•´ì¤€ë‹¤.
```

### git

git ì €ì¥ì†Œì— node_modulesë¥¼ ì˜¬ë¦´ í•„ìš”ëŠ” ì—†ë‹¤. ì¼ë‹¨ ìš©ëŸ‰ì´ ë§ê³  `npn install` ì„ í•˜ë©´ `package.json`ì— ì„¤ì¹˜í•  moduleì— ëŒ€í•œ ì •ë³´ê°€ ìˆê¸° ë•Œë¬¸ì— ì•Œì•„ì„œ ì„¤ì¹˜ê°€ ëœë‹¤.

### BodyParser & PostMan

##### BodyParser

- í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë³´ë‚´ì£¼ëŠ” ë°ì´í„°ë¥¼ ë°›ì•„ì£¼ëŠ” dependencyì´ë‹¤.

``` javascript
const bodyParser = require('body-parser');
const { User } = require("./models/User");

//application/x-www-form-urlencoded ì„ ë¶„ì„í•´ì„œ ê°€ì ¸ì˜¤ëŠ” ê²ƒ....
app.use(bodyParser.urlencoded({extended: true}));
//application/json ì„ ë¶„ì„í•´ì„œ ê°€ì ¸ì˜¤ëŠ” ê²ƒ....
app.use(bodyParser.json());

// route
app.post('/register', (req, res) => {

	// íšŒì› ê°€ì… í•  ë•Œ í•„ìš”í•œ ì •ë³´ë“¤ì„ clientì—ì„œ ê°€ì ¸ì˜¤ë©´
	// ê·¸ê²ƒë“¤ì„ ë°ì´í„° ë² ì´ìŠ¤ì— ë„£ì–´ì¤€ë‹¤.
	const user = new User(req.body)

	user.save((err, userInfo) => {
		if (err) return res.json({ success: false, err })
		return res.status(200).json({
			success: true
		})
	})
})
```



##### postman

- Postmanì€ ê°œë°œí•œ APIë¥¼ í…ŒìŠ¤íŠ¸í•˜ê³ , í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ê³µìœ í•˜ì—¬ API ê°œë°œì˜ ìƒì‚°ì„±ì„ ë†’ì—¬ì£¼ëŠ” í”Œë«í¼ì´ë‹¤.
- í´ë¼ì´ì–¸íŠ¸ë¥¼ ë§Œë“¤ì–´ ë‘” ê²ƒì´ ì—†ê¸° ë•Œë¬¸ì— postmanì„ ì´ìš©í•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ë ¤ê³  í•œë‹¤.

1. urlì— http://localhost:3000/registerì„ ì…ë ¥. ê·¸ ì•ì— POSTë¡œ ì„¤ì •

2. body íƒ­ì—ì„œ raw, JSONì„ ì„ íƒ

3. ``` json
   {
       "name": "mijeong",
       "email": "mijeong@naver.com",
       "password": "1234567"
   }
   ```

4. sendë¥¼ ë³´ë‚´ê³  ì‘ë‹µì„ ì˜ ë°›ëŠ”ì§€ í™•ì¸ ("success: true"ë¼ëŠ” jsonì„ ë°›ìœ¼ë©´ ì„±ê³µ)

##### ë¬¸ì œ

- ê³„ì† body-parserê°€ ì—†ì–´ì§. ê³„ì† ìƒˆë¡œ ë°›ì•„ì•¼í•œë‹¤.



### Nodemon

##### nodemon ì´ë€?

ì†ŒìŠ¤ë¥¼ ë³€ê²½í•  ë•Œ ì´ë¥¼ ê°ì§€í•˜ì—¬ ìë™ìœ¼ë¡œ ì„œë²„ë¥¼ ì¬ ì‹œì‘í•´ì£¼ëŠ” tool

##### ì„¤ì¹˜

`npm install nodemon --save-dev` 

dev ì˜µì…˜ì„ ë„£ì–´ì£¼ë©´ develop modeë¡œ ë¡œì»¬í™˜ê²½ì—ì„œë§Œ ì ìš©ì´ ëœë‹¤ëŠ” ì˜ë¯¸.

##### scripts ì¶”ê°€

ê°œë°œ í•  ë•Œì— nodemonì„ ì´ìš©í•˜ì—¬ ì‹¤í–‰í•˜ê² ë‹¤ëŠ” ì˜ë¯¸ë¡œ ì‹¤í–‰ ì»¤ë©˜ë“œë¥¼ í•˜ë‚˜ ë” ë§Œë“¤ê¸°.

scriptsì— `"dev": "nodemon index.js"`ë¥¼ ì¶”ê°€

##### ğŸ™€ëŠë‚€ì 

dockerë‚˜ ì¿ ë²„ë„¤í‹°ìŠ¤ì— ë¹„í•´ì„œ ë³„ë¡œë‹¤. í…ŒìŠ¤íŠ¸ í•´ë³´ë‹ˆê¹Œ íŒŒì¼ì´ ìˆ˜ì • ë˜ì—ˆì„ ë•Œì— ì ê¹ ì„œë²„ê°€ ë‹«í˜€ì„œ ì„œë¹„ìŠ¤ê°€ ëŠê¸´ë‹¤.

ì§€ê¸ˆ ì ê¹ ì‚¬ìš©í•˜ê¸´ ê´œì°®ì„ ë“¯ í•˜ë‚˜ ê²°êµ­ dockerë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ê² ë‹¤.

### ë¹„ë°€ ì„¤ì • ì •ë³´ ê´€ë¦¬

##### ê°œìš”

íŒŒì¼ì— user id ì™€ passwordê°€ ìˆê¸° ë•Œë¬¸ì— githubì— ë¹„ë°€ ì„¤ì • ì •ë³´ê°€ ê·¸ëŒ€ë¡œ ë…¸ì¶œë˜ëŠ” ìœ„í—˜ì´ ìˆë‹¤.

ë”°ë¼ì„œ ê·¸ëŸ° ì¤‘ìš”í•œ ì •ë³´ëŠ” ë”°ë¡œ ì €ì¥í•˜ê³  gitignoreë¡œ ê·¸ íŒŒì¼ì€ ì˜¬ë¦¬ì§€ ì•ŠëŠ”ë‹¤.

##### localì—ì„œ ê´€ë¦¬

1. dev.jsíŒŒì¼ì„ ë”°ë¡œ ë§Œë“ ë‹¤.

2. ``` javascript
   mudule.exports ={
   	mongoURI: 'mongodb+srv://mijeong:ch79854622@boilerplate.w1dqh.mongodb.net/myFirstDatabase?retryWrites=true&w=majority'
   }
   ```

##### deployí•´ì„œ cloudì—ì„œ ê´€ë¦¬

1. prod.jsíŒŒì¼ì„ ë§Œë“ ë‹¤.

2. ``` javascript
   module.exports = {
   	mongoURI: process.env.MONGO_URI
   }
   ```

##### ì´ ë‘ê°€ì§€ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ

1. key.jsíŒŒì¼ì„ ë§Œë“¤ê³ 

2. ``` javascript
   // NODE_ENVê°€ productionì´ë©´ deployê°€ ë˜ì–´ ìˆë‹¤ëŠ” ëœ»
   if(process.env.NODE_ENV === 'production') {
   	module.exports = require('./prod');
   } else {
   	module.exports = require('./dev');
   }
   ```

3. `const config = require('./config/key');`ë¥¼ ì¶”ê°€í•œ ë’¤

4. mongoose.connectì—ì„œ ì‚¬ìš©í–ˆë˜ ë¹„ë°€ ì •ë³´ë¥¼ config.mongoURIìœ¼ë¡œ ë°”ê¿”ì¤€ë‹¤.

### Bcrypt

##### ê°œìš”

ë¹„ë°€ë²ˆí˜¸ì™€ ê°™ì´ ì¤‘ìš”í•œ ì •ë³´ëŠ” ì•”í˜¸í™”í•˜ì—¬ ì €ì¥í•˜ëŠ” ê²ƒì´ ì•ˆì „í•˜ë‹¤. ê·¸ ë•Œ ì‚¬ìš©í•˜ëŠ” moduleì´ë‹¤.

##### ì„¤ì¹˜

`npm install bcrypt --save`

[ì‚¬ìš©ë²•](https://www.npmjs.com/package/bcrypt)

##### ì½”ë“œ

``` javascript
// User.js

const bcrypt = require('bcrypt');
const saltRounds = 10
               
userSchema.pre('save', function( next ){
	var user = this;
	// ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•”í˜¸í™” ì‹œí‚¨ë‹¤.

	// passwordê°€ ë°”ë€” ë•Œë§Œ ì‹¤í–‰í•œë‹¤.
	if (user.isModified('password')) {
		//saltë¥¼ ì´ìš©í•˜ì—¬ ë§Œë“ ë‹¤.
		bcrypt.genSalt(saltRounds, function (err, salt){
			if (err) return next(err)
			// hashì— ë¹„ë°€ë²ˆí˜¸ë¥¼ ë„£ì–´ì¤˜ì•¼í•œë‹¤.
			bcrypt.hash(user.password, salt, function (err, hash) {
				if (err) return next(err)
				user.password = hash;
				next()
			})
		})
	}
})
```

### ë¡œê·¸ì¸ ê¸°ëŠ¥ with Bcrypt

##### login route ë§Œë“¤ê¸°

1. ìš”ì²­ëœ ì´ë©”ì¼ì„ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì°¾ëŠ”ë‹¤.
2. ìš”ì²­ëœ ì´ë©”ì¼ì´ ë°ì´í„° ë² ì´ìŠ¤ì— ìˆë‹¤ë©´ ë¹„ë°€ë²ˆí˜¸ê°€ ë§ëŠ” ë¹„ë°€ë²ˆí˜¸ì¸ì§€ í™•ì¸í•œë‹¤.
3. ~~ë¹„ë°€ë²ˆí˜¸ê¹Œì§€ ë§ë‹¤ë©´ í† í°ì„ ìƒì„±í•œë‹¤.~~ ì´ëŠ” ë‹¤ìŒì—

```javascript
// index.js

// login route
app.post('/login', (req, res) => {
	// ìš”ì²­ëœ ì´ë©”ì¼ì„ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì°¾ëŠ”ë‹¤.
	User.findOne({ email: req.body.email }, (err, user) => {
		if (!user) {
			return res.json({
				loginSuccess: false,
				message: "ì œê³µëœ ì´ë©”ì¼ì— í•´ë‹¹í•˜ëŠ” ìœ ì €ê°€ ì—†ìŠµë‹ˆë‹¤."
			})
		}
		// ìš”ì²­ëœ ì´ë©”ì¼ì´ ë°ì´í„° ë² ì´ìŠ¤ì— ìˆë‹¤ë©´ ë¹„ë°€ë²ˆí˜¸ê°€ ë§ëŠ” ë¹„ë°€ë²ˆí˜¸ì¸ì§€ í™•ì¸.
		user.comparePassword(req.body.password, (err, isMatch) => {
			if (!isMatch)
				return res.json({ loginSuccess: false, message: "ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤."})
			// ë¹„ë°€ë²ˆí˜¸ê¹Œì§€ ë§ë‹¤ë©´ í† í°ì„ ìƒì„±.
			user.generateToken((err, user) => {
				
			})
		})
	})
})
```

-  ê¸°ë³¸ì ìœ¼ë¡œ mongooseì—ì„œ ì œê³µí•˜ëŠ” findOneì„ ì‚¬ìš©í•˜ì—¬ ì´ë©”ì¼ì„ ì°¾ëŠ”ë‹¤.

```javascript
// User.js

userSchema.methods.comparePassword = function(plainPassword, cb) {
	//plainPassword 1234567(ì•”í˜¸í™” ì‹œì¼œì„œ)   ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸
	bcrypt.compare(plainPassword, this.password, function(err, ismatch) {
		if(err) return cb(err)
		cb(null, isMatch)
	})
}
```

- `index.js`ì—ì„œ ì‚¬ìš©í•  comparePasswordì— ëŒ€í•´ì„œ ì •ì˜í•œë‹¤. (ìë°”ìŠ¤í¬ë¦½ìŠ¤ì—ì„œ ë©”ì†Œë“œì— ëŒ€í•´ ì •ì˜í•  ë•Œ ë°”ë¡œ `user.comparePassword`ì™€ ê°™ì´ ê·¸ëƒ¥ ì‚¬ìš©í•˜ë“¯ì´ ì“°ëŠ”ê²Œ ì‹ ê¸°í•˜ë‹¤.)

##### ê¶ê¸ˆí•œ ì 

- User.findOne()ì„ ì‚¬ìš©í•  ë•Œì— Userë¼ëŠ” ê°ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒ ê°™ì€ë° Userë¼ëŠ” ê°ì²´ë¥¼ ë§Œë“ ì ì´ ì—†ìŒ. ì´ê±´ ë­˜ ì˜ë¯¸í• ê¹Œ??
- ì½œë°±functionì´ë¼ëŠ” ë§ì´ ìì£¼ ë‚˜ì˜¤ëŠ”ë° ì´ê²Œ ë­˜ê¹Œ?

### í† í° ìƒì„± with jsonwebtoken

##### ê°œìš”

ë¡œê·¸ì¸ì„ í–ˆì„ ë•Œ ìœ ì €ì—ê²Œ ë¶€ì—¬í•˜ëŠ” í† í°ì„ ë§Œë“¤ì–´ ì£¼ëŠ” moduleì´ë‹¤.

##### jsonwebtoken ì„¤ì¹˜

`npm install jsonwebtoken --save`

##### [ì‚¬ìš©ë²•](https://www.npmjs.com/package/jsonwebtoken)

```javascript
// User.js

const jwt = require('jsonwebtoken')


userSchema.methods.generateToken = function(cb) {
	var user = this;

	// jsonwebtokenì„ ì´ìš©í•´ì„œ í† í°ìƒì„±.
	var token = jwt.sign(user._id.toHexString(), 'secretToken')

	user.token = token
	user.save(function(err, user) {
		if (err) return cb(err)
		cb(null, user)
	})
}
```



##### cookie-parser ì„¤ì¹˜

`npm install cookie-parser --save`

##### cookie-parser ê°œìš”

ìš°ë¦¬ëŠ” cookieì—ë‹¤ê°€ ìœ ì €ì˜ í† í°ì„ ì €ì¥í•˜ê¸°ë¡œ í–ˆê¸° ë•Œë¬¸ì— cookieì— ì €ì¥í•˜ëŠ” ê²ƒì„ ë„ì™€ì£¼ëŠ” moduleì´ í•„ìš”í•˜ë‹¤. ì´ë¥¼ ë„ì™€ì£¼ëŠ” ê²ƒì´ cooke-parserë¼ëŠ” moduleì´ë‹¤.

```javascript
// index.js

const cookieParser = require('cookie-parser');

app.use(cookieParser()
        
// ì¶”ê°€
// ë¹„ë°€ë²ˆí˜¸ê¹Œì§€ ë§ë‹¤ë©´ í† í°ì„ ìƒì„±.
user.generateToken((err, user) => {
	if (err) return res.status(400).send(err);
	// í† í°ì„ ì¿ í‚¤ì— ì €ì¥í•œë‹¤. ì‹¤ì¬ë¡œëŠ” ë¡œì»¬ìŠ¤í† ë¦¬ì§€ë‚˜ ë‹¤ë¥¸ ê³³ì—ë„ ì €ì¥ì´ ê°€ëŠ¥í•˜ì§€ë§Œ ì—¬ê¸°ì„œëŠ” ì¿ í‚¤ì— ì €ì¥í•œë‹¤.
	res.cookie("x_auth", user.token)
	.status(200)
	.json({ loginSuccess: true, userId: user._id })
})
```

##### ë™ì‘ í™•ì¸

postmanì—ì„œ jsonì„ ë³´ë‚¸ë‹¤.

```json
{
    "email": "mijeong2@naver.com",
    "password": "1234567"
}
```

##### ğŸ˜‚ì£¼ì˜ì‚¬í•­

- `user._id`ë¥¼ ì‚¬ìš©í•˜ëŠ” ë¶€ë¶„ì—ì„œ ì˜ ëª» ë˜ì—ˆê¸° ë•Œë¬¸ì— ë‚˜ì¤‘ì— ìˆ˜ì •í•œë‹¤. `user._id.toHexString()`ìœ¼ë¡œ ë„£ì–´ì¤˜ì•¼í•œë‹¤.

### Auth ê¸°ëŠ¥ ë§Œë“¤ê¸°

##### 

